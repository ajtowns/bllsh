
; references:
;  * paper: https://eprint.iacr.org/2017/965.pdf
;  * blog: https://conduition.io/cryptography/quantum-hbs/#Winternitz-One-Time-Signatures-WOTS
;  * lean4: https://github.com/jonasnick/GreatRSI/blob/master/GreatRSI/Winternitz.lean

; parameters:
;   m = 256     (bit-length of message to be signed; 32 bytes)
;   w = 16      (Winternitz param)
;   t = 4       (log2(w))
;   len_1 = 64  (ceil(m/t))
;   len_2 = 3   (floor(log2(len_1*(w-1)) / log2(w)) + 1
;   len = 67    (len_1 + len_2)

def (HASH SEED R X) (sha256 SEED (^ X R))

def (CHAIN N SEED RRAND X) (if N (HASH SEED (h RRAND) (CHAIN (- N 1) SEED (t RRAND) X)) X)

; hexdigits 0x123456 -> (6 5 4 3 2 1)

def (HEXPAIR BYTE TAIL) (rc TAIL (shift BYTE -4) (& BYTE 0x0f))
def (HEXTRIP SHORT) (rc nil (+ (shift SHORT -8)) (+ (shift (& SHORT 0xf0) -4)) (+ (& SHORT 0x0f)))
def (HEXDIGITS STR TAIL) (if STR (HEXDIGITS (substr STR 1) (HEXPAIR (substr STR 0 1) TAIL)) TAIL)

; (checksum revdigits) -> (checksum ++ normdigits)

def (REVERSE L TAIL) (if L (REVERSE (t L) (rc TAIL (h L))) TAIL)

def (CHECKSUM W C REVDIG TAIL) (if REVDIG (CHECKSUM W (- (+ C W) 1 (h REVDIG)) (t REVDIG) (rc TAIL (h REVDIG))) (REVERSE (HEXTRIP C) TAIL))

def (WOTSA W PUBKEYS SIG DIGITS) (if PUBKEYS (if (= (CHAINHASH (- W (h DIGITS)) (h SIG)) (h PUBKEYS)) (WOTSA W (t PUBKEYS) (t SIG) (t DIGITS)) (x)) 1)

def XSEED 0xb10dce54185a124a89cf3432ea7eb0475d993cf767b3ee93da70d2a8408e7834

def RANDOMIZATION (q 0x9bc6d76b5c9d462db42274e2d8218a8fe4437ee11f26a1073109896d373883b0 0x3ac3ad1fcf8fd74a273d967ef321b9dd4afaa3b98162acaca929bae8792e4230 0x73cf93da11e6ef9cc824631779e71721b689c9efeebff2362e1de9fff30c5722 0xf8d04c193829bae8ea375a8f3fa7445e0854bb4c68c5dbe3123329192e88fcee 0x69566befd19b170a319805ed4768bac0f21cae6e1b4ed06636161e022d0434ce 0x5e45fb19e001a78095ecd8018b5cc48c6511ab67dac062fa1935e921763edff1 0x3d995bc0e85f3598988be827ca159055d3bfd94765850a67fde807777e291a81 0x06b60c75675defebaa7f034fc4db85dba5ffe8ef131de8d854caf70f03f3af9e 0x9d75734be50bfd9b82294e81011d47635a684aff9e88f2a9fd483b3a780c1ab9 0x09105d299a882dd3dd4bb14d0c5e8e6811d9d5ec3fa159112c54834f7e8f542b 0x179cf9d6431be415f653b9504fd8fa51fab9815a92a7d5c06502caa381ae7ab3 0xc9088f04e3caf5db9f8f307de47ea3d778e3272e3c9538dc854789fab9c383bc 0x2519a69cc076977eb61c215ec11c1c977ef46e21e014b110ff12fd6b13e29e14 0x155c5913d3bb7f74473680592ae5c68a7d3b5d6d0606210502069d9166a353cd 0x6f752dc5317f8d5bbd85e24c57decf825fa26c537770d0baf7a515823eacd188)

def SECRETS (q 0xf78330896bb3f28da6ac77359dede5828b57f4194169566a204caf1a48d058c8 0x315bac960429814f4a5504fa352a690cce81269c5712a37342e85a110f63b789 0x38d1fe4aceca45c921e84b52eb043546593739395ff4cb2c0a7ec41b9423ef38 0x6e0f581bd9c636fe48b8ec981adf5d66cbb142cf42e944ca9754293849af95b3 0x64b426cb4f25b6528a8f299acfc57a7e5125e015a21e9ff7b8973eb26925a35d 0xc9e96c86f2996c38a0dc7647a9407a12fb36c7542084452956ee9fae0f896188 0x145ea3f04b028598fef5729e1a14f79347af88058edc40fd3a7a81d6afbbf1cb 0x1bceef969390ae69123f203117eaf59e723d1abab31dd2f1bc011e3f5564b5c6 0xb91dafc98538fb1ef8b3a83eff27740ae35d0f87116994af0dc274823cfa8cba 0x580d31947d2e152c981da97ec8751bda33c293bbc2fddde3f3b48162df736bf4 0x4d5fc0e9985f599143b721ced14688187a40bf4f77096f345c5a96d0d787d249 0xd3ed86d54e723cac3346c0a6fd98639fe30c6a79cec692d12e9b830ba469884d 0xa5baaa74811517b3927d922a973eeda2c664bcfa0d7ea4ff706001ce4d447e4d 0x0e8dd85a271d0b2676ba270f6dd5c83ec37481179212d225e91231344d8cd893 0xd5057db0c9cefec6992192a9d2a0bd16e62157e85f0d383cde99d7e72dd7d6a8 0x3fecf4335852cd8d6435b3367ddd3c0ba2e804e8ffa0a203014a86a43f2edbfb 0xf21d908794168e9012a6e1798b7f14122620635799c98c68c5ff8283d3ff8b46 0x4a4ae6a1efdaac525cf84527672f81e6b8b689acb1af3ab749dcd61998cc2526 0xbeecbb05fd96ebd660d7a80b5778dd92363830651a01a5a9d7e95c76c4ca5b13 0x01a02b9d973a4bc812ce62011126bdba00166a3c71243eced814175a1c71ecea 0x716091f7b02b2c36294592a1b1edc29cf919d5798ffce0c28e1cff09885281bd 0xb65d802593aeda41596be450a726cca13ef05b0190edca40c33c7b440ed63103 0x66273ca0ee422df119db7bdeb3f5b83b047ce72d702740d2611ca502fb0f5edf 0x217598ed2cdd2fffc40407b8d34cc5723856940b38669c7bd0628be8cfe76cbb 0xd7a67ddfeb0bced276c44418dd484b8c96fd0fafd77a312db3a02a93c9f4e5b6 0x25a1a60dd45129710d3773047e49124205c4d4034ed111c7fc448e9a1cfba86a 0x7c9e8d8e8876bdb868fb6c9a6ff03c926c2e79ad6b9c65086619fd7297f1ddea 0x3b1e5cac80c26ba5c7d56db9b1b28196e764fc3e54c89af13df613d9ddaf5fb4 0xfe6b1071eee46f488ac53a2463715726a05595ff5aece207ce6cbbcffe4f7058 0x1e54e01fd05a0772bdbc4b3a91be03401e34154cd27a8c812c9fdca62a6752b6 0x9705080f0c03aa6e4507e9a823e37c767e06564019aa7a9aa4214639197a2c55 0x1c8e20f9ec062023a6ee3bdd9c5aa3b04cf4c0417964cafd33631142d06595a0 0xcca245bd10181a9268c78218e3c00fbd4b04b3c3be601df39709ff3a4666adfb 0xc7c5e4824a2dba5833546ceca8d9dcf1df1116c6e54456ca28e7bdcee0b02073 0x9d43c464a0f3702ef3b6af5eccb9392b88a263fa6e5609d1825f9e9f21dff3a5 0xe2194f0ba8fc22b5aecec8c2f077fa4d571fbb719239b87e887128696981832a 0x38e1762abb23e1e20e9a85eae1066665f426b1b0a90ffc801c6a9b12517990c4 0x9f09cce74ff85c180ac50a8cf9830012689fa3363e1ed0cc335cad3bec1865b7 0x1af962d87bbaaf5ad4f30184c7f7e12b8e190e24ca59338e8f1e97cee983f919 0x7807aae9067b6ab44884ecf73c91326698b7937064197d57de31b268a400497d 0xfad5c07099376551923e0fc59729df5da72b7db3c6b2244e194cffa5c77e901c 0x7aae4829ebaa7987cffe42429e98e5218ae285624497c0722fc7385cdcbecea4 0x717f62d4c6f605753d157a8644e4631eda07b4f204ed03d52aa9c5bdd63c2cf2 0x6705581ffce0b08e2f6cc6ceaf3e46ea6b78476eb90606be05f78bc320f45629 0xed84148f931ce52d0eedbcaa10c613228328eeb9111c99e9b51f6d42627443e8 0x6017e807b66848067f378e3c8bc18fdd6b9fa12fc3d6a83598f5834a3b01246d 0xdb119735fdfc0bb1f03ff9516135aa0e9c37822b1d47b749101bb3b7f7308142 0x4c434bfa8374d4ed6d0b55969d671e5c940d4b7bf0cf2cbfb4b8729e9f05aa6b 0x087b21eebc1ac666068a0181266108611629a5588ce6797ffeb0ba53a8e8bf73 0xa8318e023f613456735e342a2e7e2c8c42518841de88db40202f45fb1a0a6d9e 0xc4adafe059d89f21bab85a84cdb7cb519ecc3e12487b2304df1ce5efc66e9fdf 0xa85a03919af428a41398aa64906684ebe3140586550e4dd8e3e4d7d26fd183f7 0x0969c3b7d248a982f1c4a99421b755654dce97e197ff61c802b0bc32ef0e0697 0xa3e80a930fe9e0fd461d48a3c9b8e5b0cb97dc076a0c479839ab4ea28fb37c6d 0x11d60877c9d3ceb1460c9ea4ac905fc004a28eba03e4c9d09d8a94e18e9f6369 0x37668d467ca059e7a72b5178dcde9165d18a4630282a729f91e0a0481ffcdb28 0xd6ce1854ea57db8a4f46b5ba27f4d840ef3995d786099b3c4c0d6605bb9ea2e1 0xcb58511a35c0d61dc3888a1acfd3b4fa8806717c7b3f567886666960e110a0a2 0xa296a2aea155916bd2ccc923ea52f19d937f915b0b3728eaec25392b58ad5960 0x6b64b5708dab5c402ee6fbb9072573a8b8b88ad43eb864fedb7ca57a6eaeb0ff 0x6d136ecb8c800507e2d71d5d10b9d9329bf98fe7d142274d75354cd0945d0cf4 0x9be6598b35fbd1c1a74eaa508990ecce5c3665753929cf4371d271bd8626b854 0x733f8c893c9aacbe034e533c47a8950f8347c20bb1cce8df7a55928e3ff7d35f 0x48a3f844aac9fa856cfc779dc30ff3720b25aa2aaccc5c4cb47220b7c4846dc0 0xba1319dd82b1a06c3b92fbad7836958b8a95a1a30754b57c6ec9ea43a6568715 0x4e350352274077489bb719aff6af93a2428982096b2aa2db0878a6ebb7cd09e5 0x55d8d60635f9db91a9d494792444cea890062d0f05284c937036b1c9f52dc819)

def HASHES (q 0xe7a848b9a2176261b38d952ff6d9cc982e9330f903c4e49df0254ce99c5fe710 0x515ddf607ef9eb4099da06b0f3283cf2bf2b3f0ecdb4b8ca3010cb14144ed3c8 0x3f25eead6e8d9b43317a45886c7aa86af376c6322a49cab4215e7fc8d9b2b4e1 0xe125a848fd31baab9b0b8ec4e6261de1a358b3597fd476bc0c677c6a3ae6821f 0xb3ff0f156f7ce60151466695eb69689900b38942aadf75bcb7a732888b947946 0xff650c7a0e8495866013689c78592942f253e2bbb11124c67ecc75c6e50cba9f 0xfe7d2667715f4635047aa35c1eed76742724e4ac782710a8e1c15faa1551966f 0x0158a4a1ace48877b153c79c54221ad4dbce80c59fbd9ba386ad5b46d54d2747 0xb501376255512b23e12c6ebbad3ed831ec66194631ffcbb264e48a4a45fa7e10 0x4d7c3746fd92383d2d08ff770d6d8b1ce4a313e732f81d8ae6d5e42a934ba350 0x0d4312ba7fad7a0fd435514196e0624aa464fb3d6415b40a56a4ce068a3acdec 0xa437f52e537421072acb153c643e143bcd8ec6119f68b7fe42b5f1e9a9cc6738 0x29ba94b655ab479063f704d2ebba2fc84f9681cf9d322795f2178ee47e9823e9 0xa379fc8a36f454fd7fce76dd64bf8db3eea75dcc617a5f61a1443da01ac0aa33 0x98679612a22e464fa9a6f659ad77e2eac47723f8ae1c55184b64efabab1fafe1 0xb25b93a0acaca3a7b57b8f7f7ffdc7dff698e66a31d53ca164361c5598c0eee7 0x85350c4d37f1d7c80c47a557a1439824b808af7ac1f6e563ce4e245273f8e131 0xee927eca15190883305c41603815ea55516fa75dad20f7520ecdb86494747dd9 0x448d279371fd5596f0946deccd56d2bf533a70d018bc70e27612049f0701d6bc 0xadcc2605e58cee57f1b088ccd1500134c86ff1d161b565d2bea69228429abcc9 0x69ec3f192bbece50a5a2c9a5f874ea03635c6ca004c01a5bd1c23d5a417fb698 0x4459786332cb9e95979019106c049fdb199a49860bef7be6b420ab40460636e4 0x9789c9ca811d18ea12cfb167b0b0ed2f22f8bac0c6d66266c02a0918a3882365 0xa83e0ac45cedd332a2fdaa9dadfea0765e56382ce99cd2d54df07a5e89675ecc 0x6778d7eb0a7e2b5111a95cb0f8869f09e242c20cc9877d5bf2c3c99f39254e3d 0x8cd4144fcade1ebc17524546da9f4751537eb1fd08a1a5e5e04d8b74cd83a52a 0x461ea7f9156588f7af5d12851509d8e36bc2ad0de3cead42aaca54828b911155 0x634fff913895579eef6782801c9e1ffec6fe820e07e0aa6e152701fe5446b615 0x97307b93d86bfc3079fc80be52ee2194d716517d89aff75f2f4a61483acc9883 0x8e4e58e0809bff010c57dc0153986792b6781a0b625a20f6edbecd69c1a7738e 0x16deddaedd6b05773c9c18f3a6da5b3beae6d3c416991319b97f63709de59195 0x33e99f85191232c8810fce78e20d25fe1bf445200e802d89ba21bd64fd61a87f 0x2859fa01cd7de4dcea57546f1a42a35119d89e733c3c318ea1b88f3f51b7417d 0xddbd1cdbdf06f29a651ff002152278d6be25e1eccf005ca4ccc7a84d848eb762 0xdcaee98a1593e92b83f8cc3f9cb96bc01ae6a7cfe23a62ed32c10fa7560af9dd 0x42e2d4daf2b121c8d51c6d5ffdef7c1420f101f53a020f6693324186a4a3ff43 0x793a0dec3712a04391fb5b28ca2ee5be66e41e776d16547e893e16b751b6cf0f 0xbd3a771064ff84975cc16c319317b4107d4abadaf236fbd95a38a0c4bf94d8e7 0xbc64a2604f2a7f0c379c44a1f1b7d6510ee23f04335ea5a64cee0fd4daab82f1 0xf9e9101386ba0d97bca1eac0deba79f3f79a6fba2374d6577d529982dda3dedf 0x0d3caf720427e2dc08c591a72711ffd19a73fc407d9db029ec619379c94e2973 0xe46115276aa7491251d41c0f2d45c0e902ca5650c62ff60e3c03c5aa2836f0e5 0x949fd189820729549070d773fe865aacdf5f66d4f1769139a0a4a79729ead842 0xcf9f56a75212224ab9ed975f3e64b06e72c4df9eb2f55473b22cc474a37ff88e 0x4b5858cd03c33673d80cdd7424afbe8f1a0a5c2a2681304e27a47d42f523102f 0x950f4391380289adc3e38544dcec180abe1fced3fd17bb560b1e2e31d4632d9a 0x13899864fb50883d8dc77f0b9aab655748d12730674ad4d5608d75a2fed79110 0x545be179abf104f0209f83f246c58b088c46fef6f87b3666b1fb09044db97a06 0xb809aa1da69d158f969c9157b2804bb5b2160add2cc0d0613c74611b696bb96e 0x2311f52c2a6c52e8efb08b6bd4618df969f1dc43eff7a7670ecb51b18853a4fd 0x98908240d71b9378736d8d0661c6fba9cb5451f91d29dd48ecdeef5b7202ec38 0x439a30f62175581f0cd4a3a375cb1a0b773e9332f9dffb57d98d9ca8661858db 0x7e999f63908451f86221fd79bbf730df78ff8d46b51bf34736e637fd0ea8f057 0xd1825b7a38123c50f5a4c6c35eb0c5fc5e354c9351e01ad46312147fcb0a92c0 0x0b630cb5935ef73480da77c5f06f66bcd6222a283938718c0b80defb500d7e3d 0xdcb940d1ef3b1358e369ae10f0d56385f1b0c81e407f17abbd30e6ca9ad445ac 0x64a2615ea82e1a9a03bd595769a99ac88ffd7720ab87f2d8d2a587937dd52f0a 0x139ddc92621752b10663c2e0cb2474ae4d298442e485873557a11c60189bad37 0x3b06677ce00f1542c5a89d6e52e23f0855d74110a634946b8f2f644a2dae84fe 0x1126686f2bca345a2b82d2440aad391387b76cd3cd4e8ae661d84b5311be273c 0xa8a23e0ba8422bef1ef0bf0ca928632a903f8e7e35d055ed7dae760a0c694ca9 0x10bc5a4ff274719d664acf751cfce090e9d0e2eb8677b56fa6ad00ab7d764cc6 0x6dd8996938e18f6878b0dd9ff21f2d07cc2b0ea829952eef4a0641e59651901b 0x0cf5473edb5e1557fa3dad84809f00c370761fda246f8d54623c17d439527c55 0x4237819c3eeac07dbda867fad386b8a8ad0ad70f30bbe18cdf31246014fb85b8 0x56fb29c2fc4ee5a2c8ed7f6d0e41f9c64f3281c4c76d08548025d72753e76399 0x1c71bd23c41d340eddddd11453f7b59b99c25a148cfc5405093549d860d0443b)


def SIGHASH 0xabababababababababababababababababababababababababababababababab
def WITNESS (q 0x100533d380da3629c34a2bf9515cd58c341946c631beae41c3bf7f77e12426dc 0x3bcf7bd23199dc84be2681a443e4131c6f7ae7a404367be66f85818de7c6d3cd 0x4e350352274077489bb719aff6af93a2428982096b2aa2db0878a6ebb7cd09e5 0xb64f63fc9d0a4145590bd4b806e0450379d0fba9364aa7407c43cff583dee1d5 0xa9793b605788c89ab45e26ba8737824b15f1375f06e6a8d7f7c5226121150514 0x315bac960429814f4a5504fa352a690cce81269c5712a37342e85a110f63b789 0x38d1fe4aceca45c921e84b52eb043546593739395ff4cb2c0a7ec41b9423ef38 0xf731b7f095fe0a196c743f227d4e4a90ae6a6b2cfd56dded168d4c3d510c5849 0x089d6e17d1f65bc1fda4b3e13d8c00e3e00f471e8a568f805938e1df3e082804 0xe0d279d161b6433ecfb79f201606de1319984059b9fe8883db808fb2d281fe80 0x0fbc379a56de655d9364935c484e1d1cc0a880c8785b1b902b29fb97e37b9a13 0x7f18fed127495dc565a1134b787586790bdb86d1da95f278a2834c14fd4d373c 0x64d3b4ac2aa2c1cdfbba38b8d8603623e515996be43c6d8f476c40c7f6bcf08d 0x580d31947d2e152c981da97ec8751bda33c293bbc2fddde3f3b48162df736bf4 0xa0b8884c02b31a8f1c0ae6deaac86c1fb71dbdc81c023922211517e0bb5c1172 0xf1cbe804954b4134e8c21956d5f24a13270da7c7b51cfeba0b663282799e1275 0xf08050a89db83006cd98a534996b6bc8c5c31c939807da340158d88a4dae4df2 0x5552984f9664c51c50d9bbd08bbf94e9f1c0dcb377590a773aced61997f0af19 0x11a73478e549d428ad8e0005d964e1a9eb3ed4be46036762ace723615d5c341d 0xf504b4d11efdc0f517efb6d79402e5672f2a427359cac16fe6b69afc2e0c4ed1 0x899144f125a3c5a5b0b36b8f7f8b8f2166c67932ce1b68c4d67730d86d2b5917 0x6e7c82ef4f569efbe2a14d0156fa620febcbf24c3c9856e2dcdb923aaa4cd12a 0xb4276f5d5854cd18854e06d1249bbaec6fcfab6b6840d26c9be305fd5393f1fc 0x34188e1cc31cbad4bef375fba23c9c3a54d3caeafffe04d71ec3df85ef95612e 0x9c1d50ce32cde45bac4a54fb481fc0bde87bad866107bf99db3f51e687d3782e 0x527adedb80693dff4827c12ca303ddc424a82e2ac30b6dca89f77864ee71f695 0x8cd4144fcade1ebc17524546da9f4751537eb1fd08a1a5e5e04d8b74cd83a52a 0x7f7ff4e54b6e04c6505986c350930daabe2266c7802f38877b8ae00900b62672 0x6c903aacf3115e7f3675369377b9b26c054625fc602a75420f12002004f14095 0x018a4d8cd263aae9d77170ace8749da5b76a09643ff3dbcaec46be7e6584abb3 0x270fe7ebea40dd3745faaeaee79f7c3765e90f55c8bd8bcb192ee8af03024584 0x97db571701565e0906f0c8507b885dbff2a279ac8eb194de77edd6da91a011f7 0xacecde6736ae6e39750fae0c7e0a403c791114d521e0a1886b5f1c95bae5d526 0x5dbdec8357f14910d306c08d2ebb8b38446a63e8bc272bb3c6693849452b821a 0xdbd45c784363fb688a69f8c9ee04e3f5515699f1c7a6461174a92d0a7a5fbb18 0x19e7d26e65ca1605c47363d147d89e2af0a274a02bf3bd6b3ccd05c17bc58640 0x226ab15fda15e18c4c6031b85d892486b6e4f4a57bcbe2bfaaf77eba411abf66 0xcf93d287d497977c913f05a2f84c3ec4be6711dbfadf10194e08b82910590c81 0xb2347e4f15fd942dbc37e951db3185baa8aeb702cfe340d85415dc172d4d70e4 0x449f61188e1d181252acacb08c2f7153badfc70ca6557ea883d859d5e1169534 0x342030abb97436e3e5ce670567f217aa7c5d8c078c236f13204e68b9098172c1 0xb09b1246aec20a4bf9393551ddee8479f8d92b9ae2f367eb1a252a9ee01c2275 0xf0da98fa3609e8e159986d641c447651503c0044077d39375650f3a46d21309c 0x8778c423e12c9eb86d27ef9c8e18877baa9680679d4f3637de4a4c2e0c4d8afc 0x5a0c1445e5a12b77de403338ae1dbedd61c4829fe8571dfa7213c62c1af290fc 0xb21e1cd8b6964f38a76474ba714d38d0f0011ab96980e775b0b51d0ad943ec61 0xb4204687b242eb01b8232780ebf3a6a56755a863c7289beaadc149cb83fb04fd 0x9115d5a68fdf2d6febad615f60cc8b3decd7acedb10a6a206e5ad144c1475512 0x188026bffbc91e129b1e642025d24f211790181eb7e73ec432ad85cae089eb4b 0x632e037ca0f57ad5d0653f4b4e3584249d51eb93f9827640cfc098e24e598d04 0x4c4f75e520966c9d724e811486b700d4708d6acaf5326f417453e6ad68df3904 0x0eb4df7891294fa95ab5eaeaba7684e97706b4f7d540407b2c061372d26272ef 0x35136a6475026fe328446ebe9cd61a4d8d3af98c653292259ad2c70e7e97bf4f 0x8153febb48470b1460c67d7fb9031d4b120f54489a32e2e2723b5acefbea13ed 0x1ec028c7f0ddc70bda66082ae2064cb8aebaa84560dc52fa37b5b441e62a6257 0x0b630cb5935ef73480da77c5f06f66bcd6222a283938718c0b80defb500d7e3d 0xe7cadeda6b414c10c33334a3b66aadc2d480673640b28513311e8f274668dbf1 0x64a2615ea82e1a9a03bd595769a99ac88ffd7720ab87f2d8d2a587937dd52f0a 0x9c2147dc138959bc7efb8ea147edfa9863977a9a20c8948f7db76df2e22b181e 0xe1099034e14f27fe166e3594d183567c10a96ebb43f0611a68f00b1ca5ccde48 0xed576ba5a8ce9bbc42c959e9253c384cc6cd41693ae7ae936d8d61cff798205d 0xe038f13397d90e51bb2a7749fff137152d4ef8f4baf098058979c4e391ca8c08 0x806ab766fc459dc45e9099d8136cbbd2defa783eed02dc041e664ebb9edb4a4f 0x9fb3f7ef26884ce44a19c3b0b0e23d87bc1c8ba4b77d60eb505e87cd650b4c60 0x1ea98e290944a9ff1198c93be71da842bc59b5a934721850bc022140a78ba154 0x2e6b1928da18d19d0c93c8b946e038e17d7bc65cd7659198dfc8e9208ce0f506 0x32c1ec350e3f5f427d33545281092533035923dcb8f7ec31f5e3705f72be1581 0xd23e2c728b3a7f67ae6f7400cf44692b22cebdea193c159049bdd96a0d824c2e)

def SIGHASH2 0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff
def WITNESS2 (q 0xd4128b44e5b44ff56e51c8399c23f7607b02fbfa6495eaf934077abdc59c6d96 0x4c5fd9a95dccdfdbfb6abfb9c24520e1bf222a31f8dd04e0aa074e39f6185028 0xdca4804d7b5e8f88a6845900532f6a60c5f4b9da9e2825d169d6e27ef23e19f9 0xf8b891ee694dc66f08cf5b819edeb4002fe45136217a67687a22afbbad6dbcaf 0xb0a34a6a0c6f459c963ec4af9e2b5d4fb3de6ee4823730df3b99ee3bfd53f590 0x1fc2e2465b28bf0e7e2b41c5199d879445759761ec1dcbdc4ade988225a85a83 0x47b00a74f089e98ddc99bfb06460c8b3182dfcaaea1e4e7882134583e615c9dd 0xeccd7bf640ecd2d10adfb7b78f516ef46d0be651b3cd3d60ec729eb9f10ba2e2 0x34f48d9f721d03d613f027c23d9ba6c7703fa705e53e2f3827110a4fbb68ab02 0xbe167a28d69f361f37b9e9e824d7220f5420469f230afbdeaa3c0a999cd0b732 0xbe7a9713846eff9d5b6c8be33d8fd5afbd7b5ea584aa5bb61e1d35c1238d0d94 0x2dfdfd02ba12b7ef67cd20b9a58889def6544e26485ff9a2f44b4dce7e74e055 0xe8bca6af89364a7a50c3dd127aacb71c84ea03040f1b0b52587ae70f59260a4c 0x50f4acfaaea53947803ada2decd5e6fc55c106a49cd146b28c59b96a1bab12ea 0x6065820b1dd12594263a2e5199c55606e7e4cf2d9e3b97ee659c87f1d590bcf3 0x3309ad37aa2dca2eaa9d179c51425ae82586f06c44decf3120e5f994a5f098d3 0x9cdbc89c7b1c415f5b7e1780bc9469a9a61662bdc18b99f35ddb92e71f1d1140 0x85350c4d37f1d7c80c47a557a1439824b808af7ac1f6e563ce4e245273f8e131 0xee927eca15190883305c41603815ea55516fa75dad20f7520ecdb86494747dd9 0x3127ea6166c33cbe98781df65427af901f52b9c8666060bc4b2085a7f901a47c 0x566648395a4ce176feab646ba1d21ad971089f755cc5ed8e1095468bd42e6d3b 0x9d95d5ddf7047073efd1595d4b614a5245513f419a5d3c88bbf012c6c2ff6e5a 0x718b09d8f65f4646515f8d5fd322bdd9c3eb343108f82b1e97c0ddbaa163210b 0xc23f8b0b9ea425d387c363929452374b1d0e7318685931356878714c599b58e5 0x9010030822ad7b3c2dc707092f5cd7ccab14eaf3f4f26ad72b979d5653bbe01b 0xfb75a413858b9e761b555e79e62f79581006104bf230e8ec5d6455d0cbb0df3c 0x9417d47597f966cb3d3a27e7c6c906c72193c57c5be195086c06ab618cda0824 0x7f7ff4e54b6e04c6505986c350930daabe2266c7802f38877b8ae00900b62672 0x0e7f3063e91369ac111eb563ada99c87eaac399319bf524e13df39460dce008d 0xe2fd01e5db9fcf6b3a1d99428533fedb8e91da9ea81c4ad4ed1d85013815d620 0x9c7c37dd64bb602ab8f0629aeb578c9fe18f4aec695d688b9070b0e78238c8a7 0x876815389d7bfff990f0e857dbdb6b367cd29ca6c97def250763e7dfbb6ca026 0x33e99f85191232c8810fce78e20d25fe1bf445200e802d89ba21bd64fd61a87f 0x02580352df49de15a5bb518ba75e2a358f89b61c56b1341a7dcab1fd81ea5c61 0xc4ea612831830e0a876fdf6c99b004b24552908a2bc56d2c1f0233c571617914 0x1c8e20f9ec062023a6ee3bdd9c5aa3b04cf4c0417964cafd33631142d06595a0 0x4e180416b2791f9e9e31863dfd41e7c11af5e7ab4d0afd891bbd38ca88924a0d 0x15eeb1c18e6a14af8f19d0b3ee24899e2ac61983f163af32ffa4800df179f968 0x9d43c464a0f3702ef3b6af5eccb9392b88a263fa6e5609d1825f9e9f21dff3a5 0x795545beeb683d29f36390c430cbff1f5ec568130f359ae1f97a52546acea78a 0xf9e9101386ba0d97bca1eac0deba79f3f79a6fba2374d6577d529982dda3dedf 0x02de7b47b7a86137e897c9a0ad6439f717c78c1e92025f6fd1533a05d90e99d9 0xe46115276aa7491251d41c0f2d45c0e902ca5650c62ff60e3c03c5aa2836f0e5 0x1dd7322ca9177e481d045f40d544d025b9f1fee70b185378ea03979a70cd5ae6 0x42fb1b6356abf816c07e54317c389ea35d99b0f01d2f7cbe903ba4f560eb0840 0xae00e867a16c7b19bcf5afc09a2769e3d8960c16962c092cce52aff15d92ebdc 0x4c4e5b617a688e22fbdf9d50f5384b26bc0c4d5567e5aebda91e7859028d176b 0xe021ba76dcad93035b4f7cfb0bf97bf0f80870973fb69b93796743d17aac715a 0xe3129607a721b0c6c1cbd4fd5ef922d78b94246bee2b646333138532726ff833 0xe7284aaecf145c9db16aadaa3e1cf0829f0acb8eb0d7884f2e79d82a38bdf2c1 0x2311f52c2a6c52e8efb08b6bd4618df969f1dc43eff7a7670ecb51b18853a4fd 0x209515ae5c7a4084beba663d84d504ee643bb215075d1b8697294a18aeeec4e6 0x1985b49af003ca28539c8b264dea771573042f8ab7362c3b11fec0f995980b50 0xadf871052422c3ba8043296bf296c191df4ffb0a3ef46cef17db42cddf43f0ae 0xc4adafe059d89f21bab85a84cdb7cb519ecc3e12487b2304df1ce5efc66e9fdf 0x1c5a3c4154b451ea45a950abec6c8c4f51616072f87b6f718794bc64e47f021c 0xe7cadeda6b414c10c33334a3b66aadc2d480673640b28513311e8f274668dbf1 0x0a6b680aba233e7ee26b06e6cf0c76c94f3ff323cc9b1c3337dd2a97a67aa8cd 0x97164500efc514ae98c8a77acfdbbce7403252fd7b60b6fc354f384ae362326b 0x7413bbef71a8eb09fa620dba148d55f74b33dfaa05cc6ddaba5dcb2a43137186 0x10fe7c7121c5a6e85c98dc4fee39db7a7953ff7ea965199c13e53d9cb97ec808 0x834ed6e4df787d32ccd72a0432571588d9b7b3e16b691b78472df532a74a9e2c 0x9ee9992898f0257f21a8da48734ab9aa0ad7a121a53ff1aa30c487fc6fc085a1 0x187b6835f7f21c94de01a5c636abd03bf2ef5c96af70e8db69aea08bf9e3ca07 0x9ceeb3915c9c4db3924317b51ae228831c0735512b23582459882a0dfaaa1055 0xb0ffed873b1bdfc49fba93abb9d0ed128e2cc4d23e2f14dd2c6336649d2a1d50 0xd6df65d28cddc5ed6fdd78ac8c1caf86d069925d8f3a1f29f95cd5b33f85b4d7 0x9803d2e8194b26f8e6575e1a53dfb53be38c5eb6511c46c5a3c550eb22b15228)

eval (CHAIN 15 (XSEED) (RANDOMIZATION) (h (SECRETS)))
eval (h (HASHES))

def (DROP N L) (if N (DROP (- N 1) (t L)) L)
def (LENGTH L) (if L (+ 1 (LENGTH (t L))) 0)

def (SIGN N SEED RRAND SEC) (CHAIN N SEED (DROP (- 15 N) RRAND) SEC)

def SECP_G 0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798
def (SIGMSG M) (sha256 (SECP_G) (SECP_G) M)

eval (HEXDIGITS (SIGMSG (SIGHASH)) nil)
eval (CHECKSUM 16 0 (HEXDIGITS (SIGMSG (SIGHASH)) nil) nil)

def (WOTSB W SIG DIGITS TAIL) (if SIG (WOTSB W (t SIG) (t DIGITS) (rc TAIL (CHAIN (- W (h DIGITS)) (XSEED) (RANDOMIZATION) (h SIG)))) TAIL)

eval (rc (h (WITNESS2)) (SIGMSG (SIGHASH2)))
eval (REVERSE (HASHES) nil)
eval (WOTSB 15 (t (WITNESS2)) (CHECKSUM 16 0 (HEXDIGITS (SIGMSG (SIGHASH2)) nil) nil) nil)
eval (WOTSB 15 (t (WITNESS)) (CHECKSUM 16 0 (HEXDIGITS (SIGMSG (SIGHASH)) nil) nil) nil)
